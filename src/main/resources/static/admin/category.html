<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Category API Test</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        h2 { border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        .container { max-width: 800px; margin: auto; }
        .form-group { margin-bottom: 1em; }
        label { display: block; margin-bottom: 5px; }
        input, select, textarea { width: 100%; padding: 8px; box-sizing: border-box; }
        button { padding: 10px 15px; cursor: pointer; }
        pre { background-color: #f4f4f4; padding: 1em; border: 1px solid #ddd; }
    </style>
</head>
<body>

<div class="container">
    <h1>Category API Test Page</h1>

    <!-- Get All Categories -->
    <h2>Get All Categories</h2>
    <button onclick="getAllCategories()">Get All</button>

    <!-- Create Category -->
    <h2>Create Category</h2>
    <div class="form-group">
        <label for="createName">Name:</label>
        <input type="text" id="createName" placeholder="Enter category name">
    </div>
     <div class="form-group">
        <label for="createDescription">Description:</label>
        <textarea id="createDescription" placeholder="Enter description"></textarea>
    </div>
    <div class="form-group">
        <label for="createImage">Image:</label>
        <input type="file" id="createImage">
    </div>
    <button onclick="createCategory()">Create</button>

    <!-- Update Category -->
    <h2>Update Category</h2>
    <div class="form-group">
        <label for="updateId">Category ID to Update:</label>
        <input type="number" id="updateId" placeholder="Enter category ID">
    </div>
    <div class="form-group">
        <label for="updateName">New Name:</label>
        <input type="text" id="updateName" placeholder="Enter new name">
    </div>
    <div class="form-group">
        <label for="updateDescription">New Description:</label>
        <textarea id="updateDescription" placeholder="Enter new description"></textarea>
    </div>
    <div class="form-group">
        <label for="updateImage">New Image:</label>
        <input type="file" id="updateImage">
    </div>
    <button onclick="updateCategory()">Update</button>

    <!-- Delete Category -->
    <h2>Delete Category</h2>
    <div class="form-group">
        <label for="deleteId">Category ID to Delete:</label>
        <input type="number" id="deleteId" placeholder="Enter category ID">
    </div>
    <button onclick="deleteCategory()">Delete</button>

    <!-- Result -->
    <h2>Result</h2>
    <pre id="result-display">API responses will be shown here.</pre>
</div>

<script>
    const resultDisplay = document.getElementById('result-display');

    function displayResult(data, status) {
        resultDisplay.textContent = `Status: ${status}\n\n${JSON.stringify(data, null, 2)}`;
    }

    // Get All
    async function getAllCategories() {
        try {
            const response = await fetch('/api/category');
            const data = await response.json();
            displayResult(data, response.status);
        } catch (error) {
            displayResult({ error: error.message }, 'Error');
        }
    }

    // Create
    async function createCategory() {
        const name = document.getElementById('createName').value;
        const description = document.getElementById('createDescription').value;
        const image = document.getElementById('createImage').files[0];
        if (!name) {
            alert('Category Name is required.');
            return;
        }

        const formData = new FormData();
        formData.append('name', name);
        formData.append('description', description);
        if (image) {
            formData.append('image', image);
        }

        try {
            const response = await fetch('/api/category', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();
            displayResult(data, response.status);
            if(response.ok) getAllCategories(); // Refresh list
        } catch (error) {
            displayResult({ error: error.message }, 'Error');
        }
    }

    // Update
    async function updateCategory() {
        const id = document.getElementById('updateId').value;
        const name = document.getElementById('updateName').value;
        const description = document.getElementById('updateDescription').value;
        const image = document.getElementById('updateImage').files[0];
        if (!id || !name) {
            alert('Category ID and Name are required.');
            return;
        }

        const formData = new FormData();
        formData.append('name', name);
        formData.append('description', description);
        if (image) {
            formData.append('image', image);
        }

        try {
            const response = await fetch(`/api/category/${id}`, {
                method: 'PUT',
                body: formData
            });
            const data = await response.json();
            displayResult(data, response.status);
             if(response.ok) getAllCategories(); // Refresh list
        } catch (error) {
            displayResult({ error: error.message }, 'Error');
        }
    }

    // Delete
    async function deleteCategory() {
        const id = document.getElementById('deleteId').value;
        if (!id) {
            alert('Category ID is required.');
            return;
        }

        if (!confirm(`Are you sure you want to delete category with ID ${id}?`)) {
            return;
        }

        try {
            const response = await fetch(`/api/category/${id}`, {
                method: 'DELETE'
            });
            // For DELETE, response might not have a body, so we display a custom message
            if (response.status === 204) { // No Content
                 displayResult({ message: `Category ${id} deleted successfully.` }, response.status);
            } else {
                 const data = await response.json().catch(() => ({})); // Handle cases with no JSON body
                 displayResult(data, response.status);
            }
             if(response.ok) getAllCategories(); // Refresh list
        } catch (error) {
            displayResult({ error: error.message }, 'Error');
        }
    }

    // Initial load
    getAllCategories();
</script>

</body>
</html>