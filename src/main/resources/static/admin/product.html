<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Product API Test</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        h2 { border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        .container { max-width: 800px; margin: auto; }
        .form-group { margin-bottom: 1em; }
        label { display: block; margin-bottom: 5px; }
        input, select { width: 100%; padding: 8px; box-sizing: border-box; }
        button { padding: 10px 15px; cursor: pointer; }
        pre { background-color: #f4f4f4; padding: 1em; border: 1px solid #ddd; }
        .product-list img { max-width: 100px; max-height: 100px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Product API Test Page</h1>

    <!-- Get All Products -->
    <h2>Product List</h2>
    <button onclick="getAllProducts()">Refresh Products</button>
    <div class="product-list" id="product-list"></div>

    <!-- Create Product -->
    <h2>Create Product</h2>
    <div class="form-group">
        <label for="createName">Product Name:</label>
        <input type="text" id="createName" placeholder="Enter product name">
    </div>
    <div class="form-group">
        <label for="createPrice">Unit Price:</label>
        <input type="number" id="createPrice" placeholder="Enter price">
    </div>
    <div class="form-group">
        <label for="createQuantity">Quantity:</label>
        <input type="number" id="createQuantity" placeholder="Enter quantity">
    </div>
    <div class="form-group">
        <label for="createCategory">Category:</label>
        <select id="createCategory"></select>
    </div>
    <div class="form-group">
        <label for="createImages">Images:</label>
        <input type="file" id="createImages" multiple>
    </div>
    <button onclick="createProduct()">Create</button>

    <!-- Update Product -->
    <h2>Update Product</h2>
     <div class="form-group">
        <label for="updateId">Product ID to Update:</label>
        <input type="number" id="updateId" placeholder="Enter product ID">
    </div>
    <div class="form-group">
        <label for="updateName">New Product Name:</label>
        <input type="text" id="updateName" placeholder="Enter new name">
    </div>
    <div class="form-group">
        <label for="updatePrice">New Unit Price:</label>
        <input type="number" id="updatePrice" placeholder="Enter new price">
    </div>
    <div class="form-group">
        <label for="updateQuantity">New Quantity:</label>
        <input type="number" id="updateQuantity" placeholder="Enter new quantity">
    </div>
        <div class="form-group">
        <label for="updateCategory">New Category:</label>
        <select id="updateCategory"></select>
    </div>
    <div class="form-group">
        <label for="updateImages">New Images:</label>
        <input type="file" id="updateImages" multiple>
    </div>
    <button onclick="updateProduct()">Update</button>

    <!-- Result -->
    <h2>Result</h2>
    <pre id="result-display">API responses will be shown here.</pre>
</div>

<script>
    const resultDisplay = document.getElementById('result-display');
    const productListDiv = document.getElementById('product-list');
    const createCategorySelect = document.getElementById('createCategory');
    const updateCategorySelect = document.getElementById('updateCategory');

    function displayResult(data, status) {
        resultDisplay.textContent = `Status: ${status}\n\n${JSON.stringify(data, null, 2)}`;
    }

    async function fetchCategories() {
        try {
            const response = await fetch('/api/category');
            if (!response.ok) return;
            const categories = await response.json();
            
            createCategorySelect.innerHTML = '';
            updateCategorySelect.innerHTML = '';

            categories.forEach(cat => {
                const option1 = new Option(cat.name, cat.id);
                const option2 = new Option(cat.name, cat.id);
                createCategorySelect.add(option1);
                updateCategorySelect.add(option2);
            });
        } catch (error) {
            console.error("Failed to load categories:", error);
        }
    }

    async function getAllProducts() {
        try {
            const response = await fetch('/api/product');
            if (!response.ok) {
                productListDiv.innerHTML = 'Could not load products.';
                return;
            }
            const products = await response.json();
            let html = '<ul>';
            for (const product of products) {
                 html += `<li>
                    <strong>ID:</strong> ${product.id}<br>
                    <strong>Name:</strong> ${product.productName}<br>
                    <strong>Price:</strong> ${product.unitPrice}<br>
                    <strong>Quantity:</strong> ${product.quantity}<br>
                    <strong>Category:</strong> ${product.category ? product.category.name : 'N/A'}<br>
                    <strong>Images:</strong> ${product.images ? product.images.split(',').map(img => `<img src="/uploads/${img}" alt="${img}">`).join(' ') : 'None'}<br>
                    <button onclick="deleteProduct(${product.id})">Delete</button>
                </li>`;
            }
            html += '</ul>';
            productListDiv.innerHTML = html;
        } catch (error) {
            productListDiv.innerHTML = `Error: ${error.message}`;
        }
    }

    async function createProduct() {
        const formData = new FormData();
        formData.append('productName', document.getElementById('createName').value);
        formData.append('unitPrice', document.getElementById('createPrice').value);
        formData.append('quantity', document.getElementById('createQuantity').value);
        formData.append('categoryId', document.getElementById('createCategory').value);
        
        const files = document.getElementById('createImages').files;
        for (let i = 0; i < files.length; i++) {
            formData.append('images', files[i]);
        }

        try {
            const response = await fetch('/api/product', { method: 'POST', body: formData });
            const data = await response.json();
            displayResult(data, response.status);
            if(response.ok) getAllProducts();
        } catch (error) {
            displayResult({ error: error.message }, 'Error');
        }
    }

    async function updateProduct() {
        const id = document.getElementById('updateId').value;
        if (!id) {
            alert('Product ID is required.');
            return;
        }

        const formData = new FormData();
        formData.append('productName', document.getElementById('updateName').value);
        formData.append('unitPrice', document.getElementById('updatePrice').value);
        formData.append('quantity', document.getElementById('updateQuantity').value);
        formData.append('categoryId', document.getElementById('updateCategory').value);

        const files = document.getElementById('updateImages').files;
        for (let i = 0; i < files.length; i++) {
            formData.append('images', files[i]);
        }

        try {
            const response = await fetch(`/api/product/${id}`, { method: 'PUT', body: formData });
            const data = await response.json();
            displayResult(data, response.status);
            if(response.ok) getAllProducts();
        } catch (error) {
            displayResult({ error: error.message }, 'Error');
        }
    }

    async function deleteProduct(id) {
        if (!confirm(`Are you sure you want to delete product with ID ${id}?`)) {
            return;
        }

        try {
            const response = await fetch(`/api/product/${id}`, { method: 'DELETE' });
            displayResult({ message: `Product ${id} deleted` }, response.status);
            if(response.ok) getAllProducts();
        } catch (error) {
            displayResult({ error: error.message }, 'Error');
        }
    }

    // Initial Load
    fetchCategories();
    getAllProducts();
</script>

</body>
</html>
